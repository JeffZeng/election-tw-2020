function import$(t,e){var n={}.hasOwnProperty;for(var a in e)n.call(e,a)&&(t[a]=e[a]);return t}!function(){var t,e,n;t=function(t){return t.replace(/臺/g,"台")},e=function(t){return null==t&&(t={}),this.root="string"==typeof t.root?document.querySelector(t.root):t.root,this.lc={},this.type=t.type,this},e.prototype=import$(Object.create(Object.prototype),{init:function(){var t,e,n,a=this;return t={root:this.root,type:this.type},e=t.root,n=t.type,ld$.fetch("assets/lib/pdmap.tw/"+n+".topo.json",{method:"GET"},{type:"json"}).then(function(t){return a.lc.topo=t,ld$.fetch("assets/lib/pdmap.tw/"+n+".meta.json",{method:"GET"},{type:"json"})}).then(function(t){var n,o;return a.lc.meta=t,a.lc.features=n=topojson.feature(a.lc.topo,a.lc.topo.objects.pdmaptw).features,a.lc.path=o=d3.geoPath().projection(pdmaptw.projection),d3.select(e).append("svg").append("g").selectAll("path").data(n).enter().append("path").attr("d",o)})},fit:function(){var t,e,n,a,o,r,i,l,d,p,c;return t=this.root,e=ld$.find(t,"g",0),(n=d3.select(t).select("svg")).attr("width","100%"),n.attr("height","100%"),a=t.getBoundingClientRect(),o=e.getBBox(),r=[a.width,a.height],i=r[0],l=r[1],20,d=Math.min((i-40)/o.width,(l-40)/o.height),r=[i/2,l/2],p=r[0],c=r[1],e.setAttribute("transform","translate("+p+","+c+") scale("+d+") translate("+(-o.x-o.width/2)+","+(-o.y-o.height/2)+")")}}),pdmaptw.create=function(t){return null==t&&(t={}),new e(t)},n={},n.obj1=pdmaptw.create({root:ld$.find(document,"#map1",0),type:"town"}),n.obj2=pdmaptw.create({root:ld$.find(document,"#map2",0),type:"town"}),n.obj1.init().then(function(){return n.obj2.init()}).then(function(){return ld$.fetch("assets/election.json",{method:"GET"},{type:"json"})}).then(function(t){var e,a,o,r,i;for(n.data=t,n.hash={},e=n.data.map(function(t){return t.vote/t.total}),n.min=Math.min.apply(null,e),n.max=Math.max.apply(null,e),a=n.data.map(function(t){return(t.vote-t.valid)/t.vote}),n.invalid={min:Math.min.apply(null,a),max:Math.max.apply(null,a)},o=0,r=t.length;o<r;++o)i=t[o],n.hash[i.name]=i;return console.log(n.invalid)}).then(function(){var e,a,o;return(e=n.obj1).fit(),a=(o=n.data)[o.length-1],Math.max.apply(null,e.lc.meta.name.map(function(t){return a[t]||0})),d3.select(e.root).selectAll("path").attr("fill",function(a){var o,r;return o=t(e.lc.meta.name[a.properties.c]+e.lc.meta.name[a.properties.t]),r=n.hash[o].vote/n.hash[o].total,r=(r-n.min)/(n.max-n.min),d3.interpolateRdBu(r)}).attr("stroke",function(){return"#000"}).attr("stroke-width",function(){return 0}),new ldView({root:"[ld-scope=vote]",handler:{label:{list:function(){return[1,.8,.6000000000000001,.4000000000000001,.20000000000000007,5.551115123125783e-17]},handle:function(t){var e,a,o;return e=t.data,a=t.node,ld$.find(a,".dot",0).style.background=d3.interpolateRdBu(e),o=e*(n.max-n.min)+n.min,ld$.find(a,".name",0).innerText=Math.round(100*o)+"%"}}}})}).then(function(){var e,a;return(e=n.obj2).fit(),(a=n.data)[a.length-1],d3.select(e.root).selectAll("path").attr("fill",function(a){var o,r;return o=t(e.lc.meta.name[a.properties.c]+e.lc.meta.name[a.properties.t]),r=(n.hash[o].vote-n.hash[o].valid)/n.hash[o].vote,r=1-(r-n.invalid.min)/(n.invalid.max-n.invalid.min),d3.interpolatePiYG(r)}).attr("stroke",function(){return"#000"}).attr("stroke-width",function(){return 0}),new ldView({root:"[ld-scope=invalid]",handler:{label:{list:function(){return[1,.8,.6000000000000001,.4000000000000001,.20000000000000007,5.551115123125783e-17]},handle:function(t){var e,a,o;return e=t.data,a=t.node,ld$.find(a,".dot",0).style.background=d3.interpolatePiYG(1-e),o=e*(n.invalid.max-n.invalid.min)+n.invalid.min,ld$.find(a,".name",0).innerText=Math.round(1e3*o)/10+"%"}}}})})}();