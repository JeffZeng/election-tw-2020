!function(){var n,t,e;n={map:{}},t=popupWrap(function(t){var e,a;return e=t.data,t.evt,a=t.node,a.innerHTML+="<div>"+Math.round(1e3*n.rate[e.properties.name].kmt)/10+"%</div>"}),e=popupWrap(function(t){var e,a;return e=t.data,t.evt,a=t.node,a.innerHTML+="<div>"+Math.round(1e3*n.rate[e.properties.name].dpp)/10+"%</div>"}),n.map.kmt=pdmaptw.create({root:ld$.find(document,"#map-diff-kmt",0),type:"town",popup:t}),n.map.dpp=pdmaptw.create({root:ld$.find(document,"#map-diff-dpp",0),type:"town",popup:e}),n.map.kmt.init().then(function(){return n.map.dpp.init()}).then(function(){return ld$.fetch("assets/data/政黨總統票差距.json",{method:"GET"},{type:"json"})}).then(function(t){return n.data=t,ld$.fetch("assets/data/總統票.json",{method:"GET"},{type:"json"})}).then(function(t){var e,a,r,p,i,d,o,m,u,f,l,g;n.president=e=t,n.rate={},n.range={};for(a in r=n.data)p=r[a],n.rate[a]={pfp:p.pfp/e[a][1],kmt:p.kmt/e[a][2],dpp:p.dpp/e[a][3]};for(i=0,d=(r=["kmt","dpp","pfp"]).length;i<d;++i){o=r[i],u=[];for(f in l=n.rate)g=l[f],u.push(g[o]);m=u,n.range[o]={min:Math.min.apply(null,m),max:Math.max.apply(null,m)},n.range[o].size=n.range[o].max-n.range[o].min}return n.range.max=Math.max(n.range.kmt.max,n.range.dpp.max),n.range.min=Math.min(n.range.kmt.min,n.range.dpp.min),n.range.size=n.range.max-n.range.min}).then(function(){var t,e,a,r,p,i=[];for(t=0,a=(e=["kmt","dpp"]).length;t<a;++t)r=e[t],(p=n.map[r]).fit(),d3.select(p.root).selectAll("path").attr("fill",function(t){var e;return e=n.rate[t.properties.name][r],e=e>0?.5+.5*e/n.range.max:.5*(e-n.range.min)/-n.range.min,e=.1+.8*e,d3.interpolateRdBu(e)}).attr("stroke",function(){return"#fff"}).attr("stroke-width",function(){return.001}),i.push(new ldView({root:"[ld-scope=diff-"+r+"]",handler:{label:{list:function(){var t,e,a,r,p,i;for(e=[],a=0,p=n.range.min,r=n.range.min/3;r<0?a>=p:a<=p;a+=r)i=a,e.push(i);return t=e,[n.range.max].concat(t)},handle:function(t){var e,a,r;return e=t.data,a=t.node,r=e,r=r>0?.5+.5*r/n.range.max:.5*(r-n.range.min)/-n.range.min,r=.1+.8*r,ld$.find(a,".dot",0).style.background=d3.interpolateRdBu(r),ld$.find(a,".name",0).innerText=Math.round(1e3*e)/10+"%"}}}}));return i})}();