!function(){var t,n,a,e;t=function(t,n,a,e,r){return null==a&&(a=1),null==e&&(e=!1),null==r&&(r=d3.interpolateRdBu),{label:{list:function(){var n,a,e,r,o,i,l;for(a=[],e=t.max,o=t.avg,r=-(t.max-t.avg)/3;r<0?e>=o:e<=o;e+=r)i=e,a.push(i);for(n=a,a=[],e=t.avg,o=t.min,r=-(t.avg-t.min)/3;r<0?e>=o:e<=o;e+=r)i=e,a.push(i);return l=a,n.splice(n.length-1,1),n.concat(l)},handle:function(o){var i,l,u;return i=o.data,l=o.node,u=n(i),ld$.find(l,".dot",0).style.background=r(e?1-u:u),ld$.find(l,".name",0).innerHTML=(i===t.avg?"<span class='text-sm'>(全國平均)</span>":"")+Math.round(100*i*a)/a+"%"}}}},n=popupWrap(function(t){var n,a,r;return n=t.data,t.evt,a=t.node,r=e.hash[n.properties.name],a.innerHTML+="<div>"+Math.round(1e3*r.vote/r.total)/10+"%</div>"}),a=popupWrap(function(t){var n,a,r;return n=t.data,t.evt,a=t.node,r=e.hash[n.properties.name],a.innerHTML+="<div>"+Math.round(1e3*(r.vote-r.valid)/r.vote)/10+"%</div>"}),e={},e.obj1=pdmaptw.create({root:ld$.find(document,"#map-vote-rate",0),type:"town",popup:n}),e.obj2=pdmaptw.create({root:ld$.find(document,"#map-invalid-rate",0),type:"town",popup:a}),e.obj1.init().then(function(){return e.obj2.init()}).then(function(){return ld$.fetch("assets/data/投票數.json",{method:"GET"},{type:"json"})}).then(function(t){var n,a,r,o,i;e.hash=t,n=[];for(a in r=e.hash)o=r[a],n.push(o);return e.list=n,i=e.list.map(function(t){return t.vote/t.total}),e.voteRate={min:Math.min.apply(null,i),max:Math.max.apply(null,i),avg:e.hash["全國"].vote/e.hash["全國"].total},i=e.list.map(function(t){return(t.vote-t.valid)/t.vote}),e.invalidRate={min:Math.min.apply(null,i),max:Math.max.apply(null,i),avg:(e.hash["全國"].vote-e.hash["全國"].valid)/e.hash["全國"].vote}}).then(function(){var n,a,r;return n=function(t){return t=t>a.avg?.5*(t-a.avg)/(a.max-a.avg)+.5:.5*(t-a.min)/(a.avg-a.min)},a=e.voteRate,(r=e.obj1).fit(),d3.select(r.root).selectAll("path").attr("fill",function(t){var a;return a=t.properties.name,d3.interpolateRdBu(n(e.hash[a].vote/e.hash[a].total))}).attr("stroke",function(){return"#fff"}).attr("stroke-width",function(){return.005}),new ldView({root:"[ld-scope=vote-rate]",handler:t(a,n,1)})}).then(function(){var n,a,r;return n=function(t){return t=t>a.avg?.5*(t-a.avg)/(a.max-a.avg)+.5:.5*(t-a.min)/(a.avg-a.min)},a=e.invalidRate,(r=e.obj2).fit(),d3.select(r.root).selectAll("path").attr("fill",function(t){var a;return a=t.properties.name,d3.interpolatePiYG(1-n((e.hash[a].vote-e.hash[a].valid)/e.hash[a].vote))}).attr("stroke",function(){return"#000"}).attr("stroke-width",function(){return 0}),new ldView({root:"[ld-scope=invalid-rate]",handler:t(a,n,100,!0,d3.interpolatePiYG)})})}();