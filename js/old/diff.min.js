function import$(t,e){var n={}.hasOwnProperty;for(var r in e)n.call(e,r)&&(t[r]=e[r]);return t}!function(){var t,e,n;t=function(t){return t.replace(/臺/g,"台")},e=function(t){return null==t&&(t={}),this.root="string"==typeof t.root?document.querySelector(t.root):t.root,this.lc={},this.type=t.type,this},e.prototype=import$(Object.create(Object.prototype),{init:function(){var t,e,n,r=this;return t={root:this.root,type:this.type},e=t.root,n=t.type,ld$.fetch("assets/lib/pdmap.tw/"+n+".topo.json",{method:"GET"},{type:"json"}).then(function(t){return r.lc.topo=t,ld$.fetch("assets/lib/pdmap.tw/"+n+".meta.json",{method:"GET"},{type:"json"})}).then(function(t){var n,a;return r.lc.meta=t,r.lc.features=n=topojson.feature(r.lc.topo,r.lc.topo.objects.pdmaptw).features,r.lc.path=a=d3.geoPath().projection(pdmaptw.projection),d3.select(e).append("svg").append("g").selectAll("path").data(n).enter().append("path").attr("d",a)})},fit:function(){var t,e,n,r,a,o,i,p,d,s,m;return t=this.root,e=ld$.find(t,"g",0),(n=d3.select(t).select("svg")).attr("width","100%"),n.attr("height","100%"),r=t.getBoundingClientRect(),a=e.getBBox(),o=[r.width,r.height],i=o[0],p=o[1],20,d=Math.min((i-40)/a.width,(p-40)/a.height),o=[i/2,p/2],s=o[0],m=o[1],e.setAttribute("transform","translate("+s+","+m+") scale("+d+") translate("+(-a.x-a.width/2)+","+(-a.y-a.height/2)+")")}}),pdmaptw.create=function(t){return null==t&&(t={}),new e(t)},n={map:{}},n.map.kmt=pdmaptw.create({root:ld$.find(document,"#kmt",0),type:"town"}),n.map.dpp=pdmaptw.create({root:ld$.find(document,"#dpp",0),type:"town"}),n.map.kmt.init().then(function(){return n.map.dpp.init()}).then(function(){return ld$.fetch("assets/election.json",{method:"GET"},{type:"json"})}).then(function(t){var e,r,a,o;for(n.data=t,n.stat={},e=0,a=(r=n.data).length;e<a;++e)o=r[e],n.stat[o.name]=o;return ld$.fetch("assets/kmt-diff.json",{method:"GET"},{type:"json"})}).then(function(t){return n.kmt=t,ld$.fetch("assets/dpp-diff.json",{method:"GET"},{type:"json"})}).then(function(t){return n.dpp=t}).then(function(){var t,e,r,a,o,i,p,d,s;for(n.range={},t=0,r=(e=["kmt","dpp"]).length;t<r;++t){a=e[t];for(o in i=n[a])(p=i[o]).diff=(p.party-p.president)/p.president;s=[];for(o in i=n[a])p=i[o],s.push(p.diff);d=s,n.range[a]={min:Math.min.apply(null,d),max:Math.max.apply(null,d)},n.range[a].max>-n.range[a].min&&(n.range[a].min=-n.range[a].max),n.range[a].min<-n.range[a].max&&(n.range[a].max=-n.range[a].min),n.range[a].size=n.range[a].max-n.range[a].min}return n.range.max=Math.max(n.range.kmt.max,n.range.dpp.max),n.range.min=Math.min(n.range.kmt.min,n.range.dpp.min),n.range.size=n.range.max-n.range.min}).then(function(){var e,r,a,o,i,p=[];for(e=0,a=(r=["kmt","dpp"]).length;e<a;++e)o=r[e],(i=n.map[o]).fit(),d3.select(i.root).selectAll("path").attr("fill",function(e){var r,a;r=t(i.lc.meta.name[e.properties.c]+i.lc.meta.name[e.properties.t]);try{return a=n[o][r].diff,a=(a-n.range.min)/n.range.size,d3.interpolateRdBu(a)}catch(t){return"rgba(0,0,0,.5)"}}).attr("stroke",function(){return"#000"}).attr("stroke-width",function(){return 0}),p.push(new ldView({root:"[ld-scope="+o+"]",handler:{label:{list:function(){return[1,.8,.6000000000000001,.4000000000000001,.20000000000000007,5.551115123125783e-17]},handle:function(t){var e,r,a;return e=t.data,r=t.node,ld$.find(r,".dot",0).style.background=d3.interpolateRdBu(e),a=e*n.range.size+n.range.min,ld$.find(r,".name",0).innerText=Math.round(100*a)+"%"}}}}));return p})}();